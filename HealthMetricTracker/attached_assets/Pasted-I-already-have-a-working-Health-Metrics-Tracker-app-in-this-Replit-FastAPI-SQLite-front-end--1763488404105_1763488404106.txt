I already have a working “Health Metrics Tracker” app in this Replit (FastAPI + SQLite + front end) with:

- dynamic calorie targets based on goal mode and burn
- protein targets and weekly / monthly stats
- CBT-E style food journal entries
- “Today” and “History” sections

Please refactor and improve it according to the points below. Keep all existing data models, just adjust logic and UI where needed.

==================================================
1. DATA CLEAN-UP: REMOVE TEST DATA FOR TODAY
==================================================

I want to remove the test data currently shown for “today” and avoid seeding test rows in future.

Implement:

1. A backend endpoint:

   - `DELETE /api/daily-data/{date}`

   Behaviour:
   - Delete the `daily_metrics` row for that date, if it exists.
   - Delete all `calorie_entries` rows for that date.
   - Return a JSON summary of how many rows were deleted.

2. On the front end, near the date selector, add a small “Clear this day” button.

   - When clicked, confirm with the user.
   - If confirmed, call `DELETE /api/daily-data/{selected_date}`.
   - After success, refresh the page state for that date (metrics, entries, summary).

3. Ensure there is no automatic seeding of demo or test data on app start. All data should come from my CSV import or manual entries only.

==================================================
2. CALORIE TARGETS BASED ON HISTORIC BURN
==================================================

I want the daily calorie target to be based primarily on my historic calorie burn, not a number I guess.

**Concept**

- Use a rolling average of *actual* `calories_burned_total` over a configurable window (for example 21 or 28 days) as an estimate of “true maintenance calories”.
- The goal mode (maintenance / gentle / standard / aggressive loss) then applies a *percentage* adjustment to this maintenance estimate.

**Implementation details**

1. In `user_settings`, add fields:

   - `maintenance_window_days` (integer, default 21)
   - `loss_gentle_percent` (float, default 0.10 for 10 % deficit)
   - `loss_standard_percent` (float, default 0.15)
   - `loss_aggressive_percent` (float, default 0.20)

2. In the backend, add a helper that, for a given `date`, computes:

   - `rolling_burn_avg` = average of `calories_burned_total` over the last `maintenance_window_days` with non-null values. If there are fewer than e.g. 7 valid days, fall back to `maintenance_calories` from settings.

3. Dynamic target formula:

   - For maintenance mode:

     `base = rolling_burn_avg`

   - For weight loss modes:

     - gentle: `base = rolling_burn_avg * (1 - loss_gentle_percent)`
     - standard: `base = rolling_burn_avg * (1 - loss_standard_percent)`
     - aggressive: `base = rolling_burn_avg * (1 - loss_aggressive_percent)`

   - Clamp `base` to a floor of 1,500 kcal to avoid dangerously low targets.

   - This `base` becomes the recommended `daily_calorie_target` for that date, unless manually overridden.

4. Recompute `daily_calorie_target` whenever one of the following changes:

   - `calories_burned_total` for that date
   - goal `mode` for that date
   - any of the `user_settings` that affect maintenance or loss percentages
   - rolling average window parameters

   The recomputation should happen on the backend (in the upsert path for daily metrics and / or in a dedicated “recalculate targets” helper called whenever relevant values are updated).

5. In the summary JSON, include:

   - `rolling_burn_avg`
   - the mode, the chosen percentage deficit (for loss modes), and the final `daily_calorie_target`.

6. In the summary text, explicitly say something like:

   - “Based on an average burn of 3,200 kcal/day over the last 21 days, your maintenance is estimated at 3,200 kcal. In standard weight loss mode (15 % deficit), today’s target is 2,720 kcal.”

==================================================
3. SIMPLIFY WORKFLOW AND AUTO-UPDATE
==================================================

The app feels complicated. I want a single simple flow:

> Choose date → enter weight, steps, calories burned → log food → app continuously updates numbers and charts.

Update the front end as follows:

1. **Single save point per day**

   - Remove the idea of separate “Save metrics” vs other actions.
   - When I change any of these for the selected date:
     - Steps
     - Weight
     - Total calories burned
     - Protein target (if I manually tweak it)
   - Immediately send an API request to upsert the daily metrics and then refresh the summary and charts.
   - For food entries:
     - When I add or delete an entry, the backend already recomputes totals. After each successful operation, re-fetch the summary and charts.

2. **Visual feedback that things are up to date**

   - Add a tiny status text, such as “All changes saved” or “Saving…” near the date selector.

3. **“Today” panel kept very minimal**

   In the “Today at a Glance” area:

   - Show only the core metrics:
     - Mode (plain word)
     - Weight
     - Eaten
     - Burned
     - Target
     - Balance
     - Protein eaten and protein target

   - Show them in a compact two-row layout instead of four wide boxes, to reduce horizontal eye movement.

4. Make sure that changing the goal mode or maintenance settings immediately recalculates targets and the summary for the selected date, without manual refresh.

==================================================
4. ADD PLAIN ENGLISH TOOLTIPS
==================================================

Add hover tooltips for metrics that might be unclear. Use either the HTML `title` attribute or proper tooltip components, but keep the text short and plain.

For example:

- `Avg burn`: “Average calories burned per day over the selected period.”
- `Avg deficit`: “Average difference between calories eaten and calories burned per day. Negative means a calorie deficit.”
- `Avg weight`: “Average body weight across the days in this period.”
- `7-day rolling balance`: “Each point shows the average calorie balance over the last 7 days, smoothing out day-to-day noise.”
- `Maintenance mode`: “Target equals estimated maintenance calories. Aim for roughly stable weight.”
- `Standard loss`: “Target is about a 15 % deficit from your recent average burn. Intended for moderate weight loss.”
- For the daily metrics fields:
  - Steps: “Number of steps recorded for this day.”
  - Total calories burned: “Total energy expenditure for the day from all activity and resting burn.”
  - Protein target: “Expected daily protein intake based on roughly 2 g per kg body weight.”

Add tooltips wherever a metric name appears (cards, table headers and chart legends).

==================================================
5. FURTHER UI POLISH
==================================================

On top of the existing redesign, apply these tweaks:

1. “Today at a Glance”:

   - Make the calorie balance the most visually prominent number (large font, clear colour: green for healthy deficit, amber for slight surplus, red for large surplus).
   - Display a simple horizontal progress bar for:
     - Calories eaten vs target.
     - Protein vs protein target.
   - Keep the summary text to one or two sentences. Remove the emoji if they clutter the line.

2. Historical section:

   - Keep the table and charts, but:
     - Use fewer decimal places where not needed.
     - Label axes clearly. For example “Weight (kg)” and “Calories (kcal)”.
     - Make the rolling balance chart dashed grey line at zero and emphasise the data series in a single accent colour.

3. Food Journal:

   - For today’s entries, present each entry more like a card:
     - Heading line: time + meal slot + calories / protein badges.
     - Body: food and drink text and context.
     - Small icons or tags for “place”, “*”, and “V/L” instead of full-width columns.
   - Historical entries can remain in a tabular layout in the History section if needed.

Please implement all of the above while preserving existing functionality and database schema, and ensure the app remains fully functional and easy to use with my existing data.
